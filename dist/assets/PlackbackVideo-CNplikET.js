import{r as c,j as t}from"./react-BIpRQuPc.js";import{J as I}from"./jszip-ByqHA-S-.js";import{B as r,a as k,C as O}from"./@mui-eGiqOD66.js";import"./clsx-B-dksMZM.js";import"./@emotion-Bt7F9wfD.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./@babel-DuB8yAtz.js";import"./stylis-YPZU7XtI.js";import"./react-transition-group-DzXVgFFp.js";import"./react-dom-DAU6i-71.js";import"./scheduler-CzFDRTuY.js";const M=()=>{const[n,C]=c.useState([]),[i,y]=c.useState(""),[d,w]=c.useState(""),[l,g]=c.useState([]),[h,m]=c.useState(null),[p,S]=c.useState(null),[f,N]=c.useState(null),b=c.useRef(null),v=c.useRef(null),D="https://cors-anywhere.herokuapp.com/",T=async()=>{const e=i.split("T")[0],o=i.split("T")[1],s=d.split("T")[0],a=d.split("T")[1],u=`http://127.0.0.1:5000/videos?start_date=${e}&start_time=${o}&end_date=${s}&end_time=${a}`;try{const x=await(await fetch(u)).json();C(x.s3_videos||[]),x.s3_videos.length>0&&m(x.s3_videos[0])}catch(j){console.error("Error fetching videos:",j)}},V=e=>{g(o=>o.includes(e)?o.filter(s=>s!==e):[...o,e])},E=()=>{g(l.length===n.length?[]:n)},R=e=>{m(e)},W=async()=>{const e=new I;for(const o of l)try{const a=await(await fetch(D+o)).blob(),u=o.split("/").pop();e.file(u,a)}catch(s){console.error("Error downloading video:",s)}e.generateAsync({type:"blob"}).then(o=>{const s=document.createElement("a");s.href=URL.createObjectURL(o),s.download="videos.zip",document.body.appendChild(s),s.click(),document.body.removeChild(s)})},_=()=>{const e=n.indexOf(h);e!==-1&&e<n.length-1&&m(n[e+1])},P=()=>{const e=v.current,o=b.current;e.width=o.videoWidth,e.height=o.videoHeight,e.getContext("2d").drawImage(o,0,0,e.width,e.height);const a=e.toDataURL("image/png");S(a),N(a)},A=()=>{if(f){const e=document.createElement("a");e.href=f,e.download="screenshot.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)}};return t.jsxs("div",{className:"flex min-h-screen bg-white",children:[t.jsxs("div",{className:"w-[70%] flex flex-col items-center pt-10 text-gray-500 text-lg bg-gray-200",children:[t.jsx("h1",{className:"mb-4 text-xl font-semibold",children:"Playback Video Player"}),t.jsx("div",{children:h?t.jsx("video",{ref:b,width:"1020",height:"720",controls:!0,autoPlay:!0,muted:!0,src:h,onEnded:_}):t.jsx("p",{className:"text-gray-500",children:"Click on a video to play it."})}),t.jsx("div",{className:"mt-4",children:t.jsx(r,{variant:"contained",onClick:P,sx:{backgroundColor:"#1976d2",color:"white",height:"48px","&:hover":{backgroundColor:"#1565c0"}},children:"Take Screenshot"})}),p&&t.jsxs("div",{className:"mt-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Captured Screenshot"}),t.jsx("img",{src:p,alt:"Screenshot",className:"mt-2 border rounded"}),t.jsx("div",{className:"mt-2",children:t.jsx(r,{variant:"contained",onClick:A,sx:{backgroundColor:"#1976d2",color:"white",height:"48px","&:hover":{backgroundColor:"#1565c0"}},children:"Download Screenshot"})})]}),t.jsx("canvas",{ref:v,style:{display:"none"}})," "]}),t.jsxs("div",{className:"w-[30%] p-8 space-y-6 bg-gray-100",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Start Date Time:"}),t.jsx(k,{type:"datetime-local",value:i,onChange:e=>y(e.target.value),fullWidth:!0,variant:"outlined",sx:{backgroundColor:"#f0f0f0"}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"End Date Time:"}),t.jsx(k,{type:"datetime-local",value:d,onChange:e=>w(e.target.value),fullWidth:!0,variant:"outlined",sx:{backgroundColor:"#f0f0f0"}})]}),t.jsx(r,{variant:"contained",fullWidth:!0,onClick:T,sx:{backgroundColor:"#1976d2",color:"white",height:"48px","&:hover":{backgroundColor:"#1565c0"}},children:"SHOW VIDEO"}),n.length>0&&t.jsx(r,{variant:"contained",fullWidth:!0,onClick:E,sx:{backgroundColor:l.length===n.length?"#d32f2f":"#1976d2",color:"white",height:"48px","&:hover":{backgroundColor:l.length===n.length?"#b71c1c":"#1565c0"}},children:l.length===n.length?"Deselect All":"Select All"}),l.length>0&&t.jsx(r,{variant:"contained",fullWidth:!0,onClick:W,sx:{backgroundColor:"#1976d2",color:"white",height:"48px","&:hover":{backgroundColor:"#1565c0"}},children:"Download Selected Videos as ZIP"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:"Recorded Videos"}),t.jsx("ul",{className:"mt-4 space-y-2",children:n.map((e,o)=>t.jsxs("li",{className:"flex items-center space-x-2",children:[t.jsx(O,{checked:l.includes(e),onChange:()=>V(e)}),t.jsx(r,{onClick:()=>R(e),children:e.split("/").pop()})]},o))})]})]})]})};export{M as default};
